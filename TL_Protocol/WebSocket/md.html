<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>WebMarket API</title>
<style>

</style>

<link href="http://cdn.bootcss.com/bootstrap/2.3.2/css/bootstrap.css" rel="stylesheet">
<script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/2.3.2/js/bootstrap.js"></script>
<script src="console.js"></script>

</head>
<body>
<div class="row-fluid">
	<div class="span6">
	<h4>Console Log</h4>
	<div class="console"> </div>
	</div>
	<div class="span6">
		<div>
				<div class="control-group">
					<div class="controls">
						<input id='sockjs_address' type="text"class="input" value='ws://127.0.0.1:8080/'></input> <button class="btn btn-success" onclick='onCreateSocket()'>CreateSocket</button>
					</div>
				</div>
				<div class="control-group">
				</div>
				
				<div class="control-group">
					<div class="controls">
						<input id='username' type="text" placeholder="username" class="input-small" value='8500001'> <input id='password' type="text" placeholder="password" class="input-small" value='123456'> <button class="btn btn-success" onclick='onLogin()'>Login</button>
					</div>
				</div>
				<div class="control-group">
					<div class="controls">
						<input id='register_symbol' type="text"class="input" value='CLK7'></input> <button class="btn btn-success" onclick='onRegisterSymbols()'>RegisterSymbols</button>
					</div>
				</div>
				
					
    </div>

	</div>
</div>
<script>
//连接对象
var conn;
var requestID=0;
function debug(msg)
{
	kendoConsole.log(msg);
}
/*
通过socket发送数据
*/
function send(obj)
{
	var jsondata=JSON.stringify(obj);
	if(conn != null)
	{
		conn.send(jsondata);
		debug("send request:" + jsondata);
	}
	else
	{
		debug('please create socket first');
	}
}
function onSockMessage(e)
{
	var d = $.parseJSON(e.data);//JSON.parse(e.data);
	msgtype = d['msgtype'];
	data = d['payload'];
	debug("got response:"+e.data)
}

/*
订阅合约行情数据
*/
function onRegisterSymbols()
{
	var dic = {'MessageType':4000,"Request":{"SymbolID":$("#register_symbol").val(),"FieldID":240},"RequestID":++requestID};
	send(dic);
}


/*
注销合约行情数据
*/
function onClearSymbols()
{
	var dic = {'msgtype':'ClearSymbols','payload':''};
	send(dic);
}



/*
登入
*/
function onLogin()
{
	var dic = {"MessageType":1000,"Request":{"UserID":$("#username").val(),"Password":$("#password").val(),"UserProductInfo":"WebSocket HTML","MacAddress":"XXXX","ClientIPAddress":null,"FieldID":100},"RequestID":++requestID};
	send(dic);
}
/*
查询合约
*/
function onQrySymbols()
{
	var dic = {"MessageType":2000,"Request":{"SymbolID":null,"ExchangeID":$("#qrysym_exchange").val(),"SecurityID":$("#qrysym_code").val(),"FieldID":104},"RequestID":++requestID};
	send(dic);
}

/*
创建Sockjs连接
*/
function onCreateSocket()
{
	if(conn != null)
	{
		conn.close();
	}
	address = $("#sockjs_address").val();
	debug('connect to server:'+address);
	conn = new WebSocket(address);
	//消息回调
	conn.onmessage = onSockMessage;
	//conn.onheartbeat = onHeartbeat;
	conn.onopen = function() {
		debug('websocket connected');
	};

	
	conn.onclose = function() {
		debug('socket close')
  };
}

$(document).ready(
	function()
	{
		debug('Welcome web trader api');
  });
            
</script>
										
</body>
</html>
