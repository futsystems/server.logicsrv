<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>WebTrader API</title>
<style>

</style>

<link href="http://cdn.bootcss.com/bootstrap/2.3.2/css/bootstrap.css" rel="stylesheet">
<script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/2.3.2/js/bootstrap.js"></script>
<script src="console.js"></script>

</head>
<body>
<div class="row-fluid">
	<div class="span6">
	<h4>Console Log</h4>
	<div class="console"> </div>
	</div>
	<div class="span6">
		<div>
				<div class="control-group">
		      <div class="controls">
						<input id='sockjs_address' type="text"class="input" value='ws://127.0.0.1:41655/'></input> <button class="btn btn-success" onclick='onCreateSocket()'>CreateSocket</button>
          </div>
				</div>
				<div class="control-group">
          <div class="controls">
						<input id='symbols' type="text" placeholder="Symbols" class="input" value='IF1505,ag1509'><button class="btn btn-success" onclick='onRegisterSymbols()'>RegisterSymbols</button>
						<button class="btn btn-success" onclick='onClearSymbols()'>ClearSymbols</button>
          </div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<input id='username' type="text" placeholder="username" class="input-small" value='8500001'> <input id='password' type="text" placeholder="password" class="input-small" value='123456'> <button class="btn btn-success" onclick='onLogin()'>Login</button>
          </div>
				</div>
				<div class="control-group">
					<div class="controls">
						<input id='qrysym_exchange' type="text" placeholder="exchange" class="input-small" value=''> <input id='qrysym_code' type="text" placeholder="sec_code" class="input-small" value=''> <button class="btn btn-success" onclick='onQrySymbols()'>QrySymbols</button>
          </div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryActiveSymbols()'>QryActiveSymbols</button>
					</div>
				</div>
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryOrder()'>QryOrder</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryTrade()'>QryTrade</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryPosition()'>QryPosition</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryAccount()'>QryAccount</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<label class="control-label" for="placeorder_symbol">Symbol</label>
						<input id='placeorder_symbol' type="text" placeholder="symbol" class="input-small" value='IF1502'>
						
						<label class="control-label" for="placeorder_size">Size</label>
						<input id='placeorder_size' type="text" placeholder="size" class="input-small" value='1'>
						
						<label class="control-label" for="placeorder_price">Price</label>
						<input id='placeorder_price' type="text" placeholder="price" class="input-small" value='0'>
						
						<label class="control-label" for="placeorder_side">Side</label>
						<input id='placeorder_side' type="text" placeholder="side" class="input-small" value='1'>
						
						<button class="btn btn-success" onclick='onPlaceOrder()'>PlaceOrder</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<label class="control-label" for="cancelorder_order_id">OrderID</label>
						<input id='cancelorder_order_id' type="text" placeholder="order_id" class="input-small" value='1'>
						
						<button class="btn btn-success" onclick='onCancelOrder()'>CancelOrder</button>
					</div>
				</div>
					
    </div>

	</div>
</div>
<script>
//连接对象
var conn;
var requestID=0;
function debug(msg)
{
	kendoConsole.log(msg);
}
/*
通过socket发送数据
*/
function send(obj)
{
	var jsondata=JSON.stringify(obj);
	if(conn != null)
	{
		conn.send(jsondata);
		debug("send request:" + jsondata);
	}
	else
	{
		debug('please create socket first');
	}
}
function onSockMessage(e)
{
	var d = $.parseJSON(e.data);//JSON.parse(e.data);
	msgtype = d['msgtype'];
	data = d['payload'];
	debug("got response:"+e.data)
}

/*
订阅合约行情数据
*/
function onRegisterSymbols()
{
	var dic = {'msgtype':'RegisterSymbols','payload':{'symbols':$("#symbols").val()}};
	send(dic);
}

/*
注销合约行情数据
*/
function onClearSymbols()
{
	var dic = {'msgtype':'ClearSymbols','payload':''};
	send(dic);
}
/*
登入
*/
function onLogin()
{
	var dic = {"MessageType":1000,"Request":{"UserID":$("#username").val(),"Password":$("#password").val(),"UserProductInfo":"WebSocket HTML","MacAddress":"XXXX","ClientIPAddress":null,"FieldID":100},"RequestID":++requestID};
	send(dic);
}
/*
查询合约
*/
function onQrySymbols()
{
	var dic = {"MessageType":2000,"Request":{"SymbolID":null,"ExchangeID":$("#qrysym_exchange").val(),"SecurityID":$("#qrysym_code").val(),"FieldID":104},"RequestID":++requestID};
	send(dic);
}

/*
查询主力合约
*/
function onQryActiveSymbols()
{
	var dic = {'msgtype':'QryActiveSymbols','payload':''}
	send(dic)
}

/*
提交委托
*/
function onPlaceOrder()
{
	symbol = $("#placeorder_symbol").val();
	size = $("#placeorder_size").val();
	price = $("#placeorder_price").val();
	side = $("#placeorder_side").val();
	var dic = {'msgtype':'PlaceOrder','payload':{'symbol':symbol,'size':size,'price':price,'side':side==1?true:false,'offset_flag':'UNKNOWN'}};
	send(dic);
}

/*
撤销委托
*/
function onCancelOrder()
{
	order_id = $("#cancelorder_order_id").val();
	var dic = {'msgtype':'CancelOrder','payload':{'order_id':order_id}};
	send(dic);
}

/*
查询帐户当日委托记录
*/
function onQryOrder()
{
	//{"MessageType":3000,"Request":{},"RequestID":++requestID}; 请求字段可以缺省 不需要的字段可以全部留空 服务端取默认值
	var dic = {"MessageType":3000,"Request":{"SymbolID":null,"ExchangeID":null,"OrderSysID":null,"FieldID":106},"RequestID":++requestID};
	send(dic);
}

/*
查询帐户当日成交记录
*/
function onQryTrade()
{
	var dic = {'msgtype':'QryTrade','payload':''}
	send(dic);
}

/*
查询帐户持仓信息
*/
function onQryPosition()
{
	var dic = {'msgtype':'QryPosition','payload':''}
	send(dic);
}

/*
查询帐户信息
*/
function onQryAccount()
{
	var dic = {'msgtype':'QryAccount','payload':''}
	send(dic)
}
/*
创建Sockjs连接
*/
function onCreateSocket()
{
	if(conn != null)
	{
		conn.close();
	}
	address = $("#sockjs_address").val();
	debug('connect to server:'+address);
	conn = new WebSocket(address);
	//消息回调
	conn.onmessage = onSockMessage;
	//conn.onheartbeat = onHeartbeat;
	conn.onopen = function() {
		debug('websocket connected');
	};

	
	conn.onclose = function() {
		debug('socket close')
  };
}

$(document).ready(
	function()
	{
		debug('Welcome web trader api');
  });
            
</script>
										
</body>
</html>
