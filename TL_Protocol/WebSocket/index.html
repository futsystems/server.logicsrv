<!DOCTYPE html>
<html lang="zh-cn">
<head>
<title>WebTrader API</title>
<style>

</style>

<link href="http://cdn.bootcss.com/bootstrap/2.3.2/css/bootstrap.css" rel="stylesheet">
<script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/2.3.2/js/bootstrap.js"></script>
<script src="console.js"></script>

</head>
<body>
<div class="row-fluid">
	<div class="span6">
	<h4>Console Log</h4>
	<div class="console"> </div>
	</div>
	<div class="span6">
		<div>
				<div class="control-group">
		      <div class="controls">
						<input id='sockjs_address' type="text"class="input" value='ws://127.0.0.1:41655/'></input> <button class="btn btn-success" onclick='onCreateSocket()'>CreateSocket</button>
          </div>
				</div>
				<div class="control-group">
          <!--div class="controls">
						<input id='symbols' type="text" placeholder="Symbols" class="input" value='IF1505,ag1509'><button class="btn btn-success" onclick='onRegisterSymbols()'>RegisterSymbols</button>
						<button class="btn btn-success" onclick='onClearSymbols()'>ClearSymbols</button>
          </div-->
				</div>
				
				<div class="control-group">
					<div class="controls">
						<input id='username' type="text" placeholder="username" class="input-small" value='8500001'> <input id='password' type="text" placeholder="password" class="input-small" value='123456'> <button class="btn btn-success" onclick='onLogin()'>Login</button>
					</div>
				</div>
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQrySymbols()'>QrySymbols</button>
					</div>
				</div>
				
				<!--div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryActiveSymbols()'>QryActiveSymbols</button>
					</div>
				</div-->
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryOrder()'>QryOrder</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryTrade()'>QryTrade</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryPosition()'>QryPosition</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<button class="btn btn-success" onclick='onQryAccount()'>QryAccount</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<label class="control-label" for="placeorder_symbol">Symbol</label>
						<input id='placeorder_symbol' type="text" placeholder="symbol" class="input-small" value='IF1502'>
						
						<label class="control-label" for="placeorder_size">Size</label>
						<input id='placeorder_size' type="text" placeholder="size" class="input-small" value='1'>
						
						<label class="control-label" for="placeorder_price">Price</label>
						<input id='placeorder_price' type="text" placeholder="price" class="input-small" value='0'>
						
						<label class="control-label" for="placeorder_side">Side</label>
						<input id='placeorder_side' type="text" placeholder="side" class="input-small" value='1'>
						
						<button class="btn btn-success" onclick='onPlaceOrder()'>PlaceOrder</button>
					</div>
				</div>
				
				<div class="control-group">
					<div class="controls">
						<label class="control-label" for="cancelorder_order_id">OrderID</label>
						<input id='cancelorder_order_id' type="text" placeholder="order_id" class="input-small" value='1'>
						
						<button class="btn btn-success" onclick='onCancelOrder()'>CancelOrder</button>
					</div>
				</div>
					
    </div>

	</div>
</div>
<script>
//连接对象
var conn;
var requestID=0;
function debug(msg)
{
	kendoConsole.log(msg);
}
/*
通过socket发送数据
*/
function send(obj)
{
	var jsondata=JSON.stringify(obj);
	if(conn != null)
	{
		conn.send(jsondata);
		debug("send request:" + jsondata);
	}
	else
	{
		debug('please create socket first');
	}
}
function onSockMessage(e)
{
	var d = $.parseJSON(e.data);//JSON.parse(e.data);
	msgtype = d['msgtype'];
	data = d['payload'];
	debug("got response:"+e.data)
}

/*
订阅合约行情数据
*/
function onRegisterSymbols()
{
	var dic = {'msgtype':'RegisterSymbols','payload':{'symbols':$("#symbols").val()}};
	send(dic);
}

/*
注销合约行情数据
*/
function onClearSymbols()
{
	var dic = {'msgtype':'ClearSymbols','payload':''};
	send(dic);
}



/*
登入
*/
function onLogin()
{
	var dic = {"MessageType":1000,"Request":{"UserID":$("#username").val(),"Password":$("#password").val(),"UserProductInfo":"WebSocket HTML","MacAddress":"XXXX","ClientIPAddress":null,"FieldID":100},"RequestID":++requestID};
	send(dic);
}
/*
查询合约
*/
function onQrySymbols()
{
	var dic = {"MessageType":2000,"Request":{"SymbolID":null,"ExchangeID":$("#qrysym_exchange").val(),"SecurityID":$("#qrysym_code").val(),"FieldID":104},"RequestID":++requestID};
	send(dic);
}

/*
查询主力合约
*/
//function onQryActiveSymbols()
//{
//	var dic = {'msgtype':'QryActiveSymbols','payload':''}
//	send(dic)
//}


/*
提交委托
	相关枚举
	
	/// <summary>
    /// 买卖方向类型
    /// </summary>
    public enum XLDirectionType : byte
    {
        /// <summary>
        /// 买
        /// </summary>
        Buy = (byte)'0',

        /// <summary>
        /// 卖
        /// </summary>
        Sell = (byte)'1'
    }

    /// <summary>
    /// 委托类别
    /// </summary>
    public enum XLOrderType : byte
    { 
        /// <summary>
        /// 市价单
        /// </summary>
        Market = (byte)'0',

        /// <summary>
        /// 限价单
        /// </summary>
        Limit = (byte)'1',
    }
	
	/// <summary>
    /// 开平标志类型
    /// </summary>
    public enum XLOffsetFlagType : byte
    {
        /// <summary>
        /// 开仓
        /// </summary>
        Open = (byte)'0',

        /// <summary>
        /// 平仓
        /// </summary>
        Close = (byte)'1',

        /// <summary>
        /// 强平
        /// </summary>
        ForceClose = (byte)'2',

        /// <summary>
        /// 平今
        /// </summary>
        CloseToday = (byte)'3',

        /// <summary>
        /// 平昨
        /// </summary>
        CloseYesterday = (byte)'4',

        /// <summary>
        /// 强减
        /// </summary>
        ForceOff = (byte)'5',

        /// <summary>
        /// 本地强平
        /// </summary>
        LocalForceClose = (byte)'6',

        /// <summary>
        /// 未知
        /// </summary>
        Unknown = (byte)'7',
    }
	/// <summary>
    /// 投机套保标志类型
    /// </summary>
    public enum XLHedgeFlagType : byte
    {
        /// <summary>
        /// 投机
        /// </summary>
        Speculation = (byte)'1',

        /// <summary>
        /// 套利
        /// </summary>
        Arbitrage = (byte)'2',

        /// <summary>
        /// 套保
        /// </summary>
        Hedge = (byte)'3'
    }
	
	请求时候填充字符对应的ASCII码
	0	48
	1	49
	2	50
	3	51
	4	52
	5	53
	6	54
	7	55
	
	....
*/
function onPlaceOrder()
{
	symbol = $("#placeorder_symbol").val();
	size = $("#placeorder_size").val();
	price = $("#placeorder_price").val();
	side = $("#placeorder_side").val();
	//XLOrderType 委托价格大于零 为limit 否则为 market
	ordertype = price>0?49:48;
	//XLDirectionType 
	sidetype = side>0?48:49;
	//XLOffsetFlagType open close unknown
	offsettype = 55;
	var dic = {"MessageType":3010,"Request":{"UserID":null,"SymbolID":symbol,"ExchangeID":null,"OrderRef":null,"OrderType":ordertype,"Direction":sidetype,"OffsetFlag":offsettype,"HedgeFlag":49,"LimitPrice":price,"StopPrice":0,"VolumeTotalOriginal":size,"FieldID":116},"RequestID":++requestID};
	send(dic);
}

/*
撤销委托

	/// <summary>
    ///操作标志类型
    /// </summary>
    public enum XLActionFlagType : byte
    {
        /// <summary>
        /// 删除
        /// </summary>
        Delete = (byte)'0',

        /// <summary>
        /// 修改
        /// </summary>
        Modify = (byte)'3'
    }
	
*/
function onCancelOrder()
{
	order_id = $("#cancelorder_order_id").val();
	var dic = {"MessageType":3012,"Request":{"UserID":null,"OrderID":order_id,"ExchangeID":null,"OrderSysID":null,"ActionFlag":48,"FieldID":117},"RequestID":++requestID};
	send(dic);
}

/*
查询帐户当日委托记录
*/
function onQryOrder()
{
	var dic = {"MessageType":3000,"Request":{"SymbolID":null,"ExchangeID":null,"OrderSysID":null,"FieldID":106},"RequestID":++requestID};
	send(dic);
}

/*
查询帐户当日成交记录
*/
function onQryTrade()
{
	var dic = {"MessageType":3002,"Request":{"SymbolID":null,"ExchangeID":null,"TradeID":null,"FieldID":108},"RequestID":++requestID};
	send(dic);
}

/*
查询帐户持仓信息
*/
function onQryPosition()
{
	var dic = {"MessageType":3004,"Request":{"SymbolID":null,"ExchangeID":null,"FieldID":110},"RequestID":++requestID};
	send(dic);
}

/*
查询帐户信息
*/
function onQryAccount()
{
	var dic = {"MessageType":3006,"Request":{"UserID":null,"FieldID":112},"RequestID":++requestID};
	send(dic);
}
/*
创建Sockjs连接
*/
function onCreateSocket()
{
	if(conn != null)
	{
		conn.close();
	}
	address = $("#sockjs_address").val();
	debug('connect to server:'+address);
	conn = new WebSocket(address);
	//消息回调
	conn.onmessage = onSockMessage;
	//conn.onheartbeat = onHeartbeat;
	conn.onopen = function() {
		debug('websocket connected');
	};

	
	conn.onclose = function() {
		debug('socket close')
  };
}

$(document).ready(
	function()
	{
		debug('Welcome web trader api');
  });
            
</script>
										
</body>
</html>
